%header.header__all
  .header__all__main
    .mainHeader
      %h1.icon
        =link_to "/" do
          = image_tag "FURIMA_logo.svg"
      .searchmain
        %form{"accept-charset": "UTF-8", action: "#", method: "get"}
          %input{name: "utf8", type: "hidden", value: "✓"}
          %input#searchInput.searchmain--input{name: "key", placeholder: "キーワードから探す"}
          %button{type: "submit"}
            .searchmain__icon
              = image_tag "icon_search.png"
          %input{name: "authenticity_token", type: "hidden", value: "rGvQaEoXiWof9CviOMrABrWg8GvnR7RZ5CihIgqhun1x4Av6XJI7jRd8fffRfP5WFLbFT4wp6lPDQB+RLe9aTA=="}
      %ul.result-Lists
    .nav
      %ul.listsLeft
        %li.listsLeft__item.listsLeft__item--first
          .category
            = link_to "#" do
              カテゴリー
            .tree.display-None
              .categoryTree
                .categoryTree--item
                  = link_to "#", id: "#1" do
                    レディース
                  .subcatTree
                    .subcatTree--item
                      = link_to "#", id: "#1" do
                        トップス
                      .itemTree
                        .itemTree--item
                          = link_to "#", id: "#1" do
                            Tシャツ
                        .itemTree--item
                          = link_to "#", id: "#2" do
                            シャツ
                    .subcatTree--item
                      = link_to "#", id: "#2" do
                        シャケット
        %li.listsLeft__item.listsLeft__item__second
          = link_to "#", id: "#brandBtn" do
            ブランド
          %ul.brandsPulldown.display-None
      %ul.lists-Right
        - if user_signed_in?
          %li.lists-Right__item
            = link_to "マイページ", user_path(current_user.id)
        - else
          %li.lists-Right__item
            = link_to "新規会員登録",new_user_registration_path
          %li.lists-Right__item
            = link_to "ログイン",new_user_session_path
.contents
  .contents__left
    .contents__left__one
      %ul
        %li マイページ
        %li お知らせ
        %li やることリスト
        %li いいね！一覧
        %li 出品する
        %li 下書き一覧
        %li 出品した商品ー出品中
        %li 出品した商品ー取引中
        %li 出品した商品ー売却済み
        %li 購入した商品ー取引中
        %li ニュース一覧
        %li ガイド
        %li お問い合わせ
    .contents__left__two
      %h3 メルペイ
      %ul
        %li 売り上げ・振り込み申請
        %li ポイント
    .contents__left__three
      %h3 設定
      %ul
        %li プロフィール
        %li 発送元・お届け先住所変更
        - if current_user&.card
          %li= link_to "カード情報", new_card_path
        - else
          %li= link_to "カード情報登録", new_card_path
        %li メール/パスワード
        %li 本人情報
        %li 電話番号の確認
        %li
          = link_to "ログアウト", destroy_user_session_path,method: :delete
  .contents__rightt
    - if current_user&.card
      .contents__rightt__head
        %h3 クレジットカード情報
      .contents__rightt__body
        .card--brand= @card.brand
        %label カード番号
        .card--num= "**** **** **** #{@card.last4}"
        - if @card.name
          %label カード指名
          .card--name= @card.name
        =link_to "削除","/card/#{current_user.card.id}", method:"delete",class:"contents__rightt__body-btn"
    - else
      .contents__rightt__head
        %h3 クレジットカード情報入力
      = form_with url: card_index_path,local:true,id:"cardNew__form",class:"contents__rightt__body" do |f|
        %input#cardNew__form--inputHidden{type:"hidden",name:"payjp-token"}

        %label カード番号
        %span.contents__rightt__body-require 必須
        #cardNew__form--number-form.payjs-outer

        %label 有効期限
        %span.contents__rightt__body-require 必須
        #cardNew__form--expiry-form.payjs-outer

        %label セキリュティーコード
        %span.contents__rightt__body-require 必須
        #cardNew__form--cvc-form.payjs-outer

        #cardNew__form--errMessage
        = f.submit "登録する",id:"cardNew__form--submit",class:"contents__rightt__body-btn"





%script{src: "https://js.pay.jp/v2/pay.js", type: "text/javascript"}

:javascript
  if(typeof gon != 'undefined'){

    const style = {
      base: {
        backgroundColor:'#ffffff',
        '::placeholder': {
          color: '#bbbbbb',
        }
      },
      invalid: {
        color: 'red',
      }
    }

    let payjp = Payjp(gon.api_key);
    let elements = payjp.elements();
    let numberElement = elements.create('cardNumber', {style: style});
    let expiryElement = elements.create('cardExpiry', {style: style});
    let cvcElement = elements.create('cardCvc', {style: style});

    numberElement.mount('#cardNew__form--number-form');
    expiryElement.mount('#cardNew__form--expiry-form');
    cvcElement.mount('#cardNew__form--cvc-form');

    $(".contents").on("click","#cardNew__form--submit",
      function(e){
        e.preventDefault();
        payjp.createToken(expiryElement).then(function(response){
          if(response.error){
            $('#cardNew__form--errMessage').text(response.error.message);
          }else{
            $("#cardNew__form--inputHidden").attr("value",response.id);
            $("#cardNew__form").submit();
          }
        });
      }
    );
  }
